rm(list = ls())
options(stringsAsFactors = FALSE)
library(tidyverse)
path <- "/Users/minsookim/Desktop/C4A-network"
# 01. Effect of C4 copy number variation on gene expression
# ----------------------------------
imputed <- read.table(paste0(path, "/data/PsychENCODE-C4-imputed.txt"), header = TRUE)
imputed$C4_CN <- imputed$C4A_CN + imputed$C4B_CN
imputed <- imputed %>% dplyr::select(-c(diagnosis, sex, study)) # datMeta already contains this information
# Load PsychENCODE expression + metadata
load(paste0(path,"/data/PsychENCODE_regressed.RData"))
datExpr <- datExpr.AllRegressed
rm(datExpr.AllRegressed)
sum(colnames(datExpr) == datMeta$X) # 2160 total samples
datMeta <- datMeta %>% filter(tissue == "frontal cortex") # 2026 frontal cortical samples
datExpr <- as.data.frame(datExpr)
datExpr <- datExpr %>% dplyr::select(datMeta$X)
datMeta <- datMeta %>% filter(individualID %in% imputed$sample) # 916 samples with C4 imputation
datExpr <- datExpr %>% dplyr::select(datMeta$X)
datMeta <- cbind(datMeta, imputed[match(datMeta$individualID, imputed$sample),])
datExpr <- as.matrix(datExpr)
# 02. Moderation of C4 gene co-expression by C4 copy number variation
# ----------------------------------
datMeta <- datMeta %>% mutate(pd_avg = (dose1 + dose2)/2) %>% filter(pd_avg >= 0.7)
# 552 samples w/ high-confidence C4 imputation results
datExpr <- datExpr %>% as.data.frame() %>% dplyr::select(datMeta$X) %>% as.matrix()
dim(datExpr)
table(datMeta$C4A_CN)
# 03. Constructing C4A gene co-expression using all samples
# ----------------------------------
table(datMeta$C4A_CN)
head(rownames(datExpr))
datExpr_low <- datExpr %>% as.data.frame() %>% dplyr::select(datMeta$C4A_CN < 2) %>% as.matrix()
datExpr_low <- datExpr %>% as.data.frame() %>% dplyr::select(datMeta$C4A_CN %in% c(1, 2)) %>% as.matrix()
datExpr_low <- datExpr[, datMeta$C4A_CN < 2]
dim(datExpr_low)
datExpr_low <- datExpr[, datMeta$C4A_CN = 2]
datExpr_mid <- datExpr[, datMeta$C4A_CN =- 2]
datExpr_mid <- datExpr[, datMeta$C4A_CN == 2]
datExpr_hig <- datExpr[, datMeta$C4A_CN > 2]
dim(datExpr_hig)
dim(datExpr_mid)
prsCor = function(i, gene, datExpr) {
c = cor.test(datExpr[i, ], datExpr[gene, ], use = "pairwise.complete.obs")
dfPrs = data.frame(Gene = rownames(datExpr[i]), R = c$estimate, P = c$p.value)
return(dfPrs)
}
dfC4A_low = data.frame()
dfC4A_mid = data.frame()
dfC4A_hig = data.frame()
dfC4A = data.frame()
for (i in nrow(datExpr)) {
if (i%%100 == 0){print(i)}
dfC4A = rbind(dfC4A, prsCor(i, "ENSG00000244731", datExpr))
dfC4A_low = rbind(dfC4A_low, prsCor(i, "ENSG00000244731", datExpr_low))
dfC4A_mid = rbind(dfC4A_mid, prsCor(i, "ENSG00000244731", datExpr_mid))
dfC4A_hig = rbind(dfC4A_hig, prsCor(i, "ENSG00000244731", datExpr_hig))
}
i
for (i in 1:nrow(datExpr)) {
if (i%%100 == 0){print(i)}
dfC4A = rbind(dfC4A, prsCor(i, "ENSG00000244731", datExpr))
dfC4A_low = rbind(dfC4A_low, prsCor(i, "ENSG00000244731", datExpr_low))
dfC4A_mid = rbind(dfC4A_mid, prsCor(i, "ENSG00000244731", datExpr_mid))
dfC4A_hig = rbind(dfC4A_hig, prsCor(i, "ENSG00000244731", datExpr_hig))
}
dfC4A_low = data.frame()
dfC4A_mid = data.frame()
dfC4A_hig = data.frame()
dfC4A = data.frame()
for (i in 1:nrow(datExpr)) {
if (i%%100 == 0){print(i)}
dfC4A = rbind(dfC4A, prsCor(i, "ENSG00000244731", datExpr))
dfC4A_low = rbind(dfC4A_low, prsCor(i, "ENSG00000244731", datExpr_low))
dfC4A_mid = rbind(dfC4A_mid, prsCor(i, "ENSG00000244731", datExpr_mid))
dfC4A_hig = rbind(dfC4A_hig, prsCor(i, "ENSG00000244731", datExpr_hig))
}
i
dfC4A = rbind(dfC4A, prsCor(i, "ENSG00000244731", datExpr))
rownames(datExpr[i])
prsCor = function(i, gene, datExpr) {
c = cor.test(datExpr[i, ], datExpr[gene, ], use = "pairwise.complete.obs")
dfPrs = data.frame(Gene = rownames(datExpr)[i], R = c$estimate, P = c$p.value)
return(dfPrs)
}
for (i in 1:nrow(datExpr)) {
if (i%%100 == 0){print(i)}
dfC4A = rbind(dfC4A, prsCor(i, "ENSG00000244731", datExpr))
dfC4A_low = rbind(dfC4A_low, prsCor(i, "ENSG00000244731", datExpr_low))
dfC4A_mid = rbind(dfC4A_mid, prsCor(i, "ENSG00000244731", datExpr_mid))
dfC4A_hig = rbind(dfC4A_hig, prsCor(i, "ENSG00000244731", datExpr_hig))
}
hist(dfC4A_low$P)
hist(dfC4A_mid$P)
hist(dfC4A_hig$P)
hist(dfC4A_mid$P)
dfC4A1 = read.table("/Users/minsookim/Dropbox/MG/complement/04_seeded_network/bootstrap_final_1e4_noSVs/dfC4A_allsamples", sep=",")
cor.test(dfC4A$R, C4A1$R[1:17963]) # 0.61, 0.54, 0.83
cor.test(dfC4A$R, dfC4A1$R[1:17963]) # 0.61, 0.54, 0.83
View(dfC4A)
View(dfC4A_mid)
plot(dfC4A$R, dfC4A1$R[1:17963]) # 0.61, 0.54, 0.83
dim(datExpr)
plot(dfC4A_low$R, dfC4A1$R[1:17963]) # 0.61, 0.54, 0.83
cor.test(dfC4A_low$R, dfC4A1$R[1:17963]) # 0.61, 0.54, 0.83
cor.test(dfC4A_mid$R, dfC4A1$R[1:17963]) # 0.61, 0.54, 0.83
cor.test(dfC4A_hig$R, dfC4A1$R[1:17963]) # 0.61, 0.54, 0.83
cor.test(dfC4A_hig$R, dfC4A1$R[1:17962]) # 0.61, 0.54, 0.83
2026
cor.test(dfC4A_hig$R, dfC4A_mid$R) # 0.61, 0.54, 0.83
cor.test(dfC4A_low$R, dfC4A_mid$R) # 0.61, 0.54, 0.83
View(dfC4A_low)
View(dfC4A_mid)
View(dfC4A_hig)
